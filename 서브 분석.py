import streamlit as st
import pandas as pd
import plotly.express as px


st.write("""
### 1. 2023년 1분기 ~ 2023년 3분기: 개인 고객 초기 구매량 감소, 법인 고객 증가 추세
초기 시장 진입 단계에서 개인 고객의 구매 저조 및 법인 고객의 투자 시작

- **개인 고객 구매량 감소**: 2023년 1분기 초기에는 개인 고객의 구매량이 상대적으로 적음. 시장 진입 초기 단계에서 소비 심리가 위축되었을 가능성이 있음.
- **법인 고객 투자 시작**: 법인 고객의 구매량은 꾸준히 증가하는 추세. 새로운 시장에 대한 초기 투자 및 사업 확장을 위한 차량 구매가 이루어지고 있음을 시사.
- **시장 변화에 대한 불확실성**: 초기 시장에서는 소비자들의 반응을 예측하기 어려워 개인 고객들이 구매를 망설이는 경향이 있음.

&nbsp;

### 2. 2023년 4분기 ~ 2024년 2분기: 개인 고객 구매량 증가, 법인 고객 주춤
시장 안정화 단계에서 개인 고객의 구매 증가 및 법인 고객의 투자 보류

- **개인 고객 구매량 증가**: 2023년 4분기부터 개인 고객의 구매량이 점차 증가. 시장이 안정화되고 있음을 나타내며, 소비자 신뢰도 상승 및 긍정적인 입소문 효과로 해석 가능.
- **법인 고객 투자 보류**: 법인 고객의 구매량은 2023년 4분기부터 주춤하는 경향. 초기 투자 이후 시장 상황을 관망하며 추가 투자를 보류하고 있을 가능성.
- **정부 정책 및 지원 효과**: 정부의 친환경차 보조금 정책이나 세제 혜택 등이 개인 고객의 구매를 촉진하는 요인으로 작용했을 수 있음.

&nbsp;

### 3. 2024년 3분기 ~ 2025년 1분기: 개인 고객 구매량 유지, 법인 고객 소폭 감소
시장 성숙 단계에서 개인 고객의 안정적인 구매 및 법인 고객의 효율성 추구

- **개인 고객 구매량 유지**: 2024년 3분기 이후 개인 고객의 구매량은 비교적 안정적으로 유지. 시장이 성숙 단계에 접어들었음을 시사.
- **법인 고객 효율성 추구**: 법인 고객의 구매량은 소폭 감소하는 경향. 초기 투자 이후 효율성을 높이기 위해 차량 운영 방식을 개선하고 있을 가능성.
- **친환경차 시장 경쟁 심화**: 다양한 브랜드의 친환경차 출시 및 경쟁 심화로 인해 개인 고객들의 선택 폭이 넓어짐. 이는 특정 브랜드에 대한 충성도를 낮추는 요인으로 작용할 수 있음.
""")



# 고객 구분별 차량 구매 현황 (스택 막대 그래프)
    #     st.subheader("고객 구분별 차량 구매 현황 분석")
    #     customer_data = df.groupby(["연령대", "고객 구분"]).size().reset_index(name="구매 수")
    #     customer_data = customer_data.pivot(index="연령대", columns="고객 구분", values="구매 수").fillna(0)
    #     customer_data = customer_data.reindex(age_order)

    #     fig = px.bar(customer_data, x=customer_data.index, y=customer_data.columns, 
    #                 title="고객 구분별 차량 구매 현황",
    #                 labels={'value': '구매 수', 'variable': '고객 구분'},
    #                 color_discrete_sequence=px.colors.qualitative.Pastel)

    #     fig.update_layout(
    #         xaxis_title="연령대",
    #         yaxis_title="구매 수",
    #         barmode='stack',
    #         legend_title="고객 구분",
    #         font=dict(size=14),
    #         plot_bgcolor='rgba(0,0,0,0)'
    #     )

    #     st.plotly_chart(fig, use_container_width=True)
    #     st.info('#### 고객 구분별 차량 구매 현황 분석 결과')
        
        

    # # 고객 구분별 평균 거래 금액 (스택 막대 그래프)
    # with subtab3:
    #     st.subheader("고객 구분별 평균 거래 금액 분석")

    #     # 데이터 준비
    #     price_data = df.pivot_table(
    #         index="연령대", 
    #         columns="고객 구분", 
    #         values="최근 거래 금액", 
    #         aggfunc="mean"
    #     ).fillna(0)

    #     # 데이터 재구성
    #     price_data = price_data.reset_index().melt(id_vars="연령대", var_name="고객 구분", value_name="평균 거래 금액")
    #     price_data["연령대"] = pd.Categorical(price_data["연령대"], categories=age_order, ordered=True)
    #     price_data = price_data.sort_values('연령대')

    #     # 스택 막대 그래프 생성
    #     fig = px.bar(
    #         price_data,
    #         x="연령대",
    #         y="평균 거래 금액",
    #         color="고객 구분",
    #         title="고객 구분별 평균 거래 금액",
    #         labels={"평균 거래 금액": "평균 거래 금액(만 원)", "연령대": "연령대", "고객 구분": "고객 구분"},
    #         color_discrete_sequence=px.colors.qualitative.Set2,  # Set2 색상 팔레트 사용
    #         barmode="stack"
    #     )

    #     # 레이아웃 설정
    #     fig.update_layout(
    #         xaxis_title="연령대",
    #         yaxis_title="평균 거래 금액(만 원)",
    #         legend_title="고객 구분",
    #         font=dict(size=14),
    #         plot_bgcolor='rgba(0,0,0,0)',
    #         xaxis=dict(tickangle=45)
    #     )

    #     st.plotly_chart(fig, use_container_width=True)
    #     st.info('#### 고객 구분별 평균 거래 금액 분석 결과')
    #     st.write("""

    #     ### 1. 30대 중반 ~ 40대 초반: 법인 고객의 평균 거래 금액 증가
    #     이 연령대에서 법인 고객의 평균 거래 금액이 급증하는 패턴을 보임

    #     - **법인 고객의 대형 거래**: 30대 중반 ~ 40대 초반에서 법인 고객의 평균 거래 금액이 높아지는 것으로 보아, 이 연령대에서 기업이 차량을 대량 구매하는 경향이 있음.
    #     - **법인 차량 운용 증가**: 이 시기의 법인 고객들은 업무용 차량 또는 리스 차량을 대량 구매하는 트렌드를 보이며, 비즈니스 확장과 관련이 있을 가능성이 큼.
    #     - **개인 고객과의 차이**: 개인 고객의 평균 거래 금액은 법인 고객에 비해 상대적으로 일정한 패턴을 유지하고 있음.

    #     &nbsp;

    #     ### 2. 20대 후반 ~ 30대 초반: 개인 고객의 평균 거래 금액 감소
    #     젊은 연령대에서 상대적으로 낮은 평균 거래 금액을 보임

    #     - **경제적 부담**: 20대 후반 ~ 30대 초반 개인 고객의 평균 거래 금액이 낮은 이유는 경제적 부담이 상대적으로 크기 때문일 가능성이 높음.
    #     - **소형차 및 중고차 선호**: 해당 연령대에서는 상대적으로 가격이 저렴한 소형차나 중고차 구매를 선호하는 경향이 있을 수 있음.
    #     - **신차보다는 리스 및 금융상품 활용**: 젊은 소비자층은 직접 구매보다 리스나 장기 렌트 등의 금융상품을 더 적극적으로 활용할 가능성이 있음.

    #     &nbsp;

    #     ### 3. 50대 이상: 안정적인 개인 고객 구매 패턴
    #     중장년층의 개인 고객들은 꾸준한 평균 거래 금액을 유지

    #     - **고급 차량 선호**: 50대 이상 개인 고객들은 상대적으로 높은 금액의 차량을 꾸준히 구매하는 경향이 있으며, 이는 프리미엄 브랜드 선호와 관련이 있을 가능성이 있음.
    #     - **법인 고객과의 차이**: 법인 고객은 연령대별로 큰 변동성이 있지만, 개인 고객은 연령이 높아질수록 비교적 일정한 패턴을 유지.
    #     - **구매력 확보**: 중장년층 개인 고객들은 경제적 안정성이 높아 신차 구매에 대한 부담이 적고, 지속적인 수요를 형성.
    #     """)